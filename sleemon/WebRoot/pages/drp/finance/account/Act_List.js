$(function(){	 //主从及主从从列表页面通用加载方法	 //listPageInits("act.shtml?action=toList");	 $("#act_Btn").click(function(){	    begAccount();	 });});function begAccount(){    //校验参数	var vCHANN_ID=$("#CHANN_ID").val();	var vYEAR=$("#YEAR").val();	var vMONTH=$("#MONTH").val();	if(vCHANN_ID==""||vCHANN_ID==null){	  parent.showErrorMsg("请选择渠道!");	  return false;	}	if(vYEAR==""||vYEAR==null){	  parent.showErrorMsg("请选择年份!");	  return false;	}	if(vMONTH==""||vMONTH==null){	  parent.showErrorMsg("请选择月份!");	  return false;	}	chkAccount(vCHANN_ID,vYEAR,vMONTH);}function chkAccount(vCHANN_ID,vYEAR,vMONTH){	//判断是否符合月结条件	$.ajax({	 	url: "act.shtml?action=chkAccount&CHANN_ID="+vCHANN_ID+"&YEAR="+vYEAR+"&MONTH="+vMONTH,	 	dataType:'json',	 	async:false,		type:"POST",		complete:function(xhr){		    eval("jsonResult = "+xhr.responseText);			if(jsonResult.success===true){			 //checkWCL(vFINANCIAL_CYCLE,vCYCLE_START,vCYCLE_END,vCYCLE_NAME)			 doAccount(vCHANN_ID,vYEAR,vMONTH);			}else			{			  parent.showErrorMsg(utf8Decode(jsonResult.messages));			}		}	});}function doAccount(vCHANN_ID,vYEAR,vMONTH){       showWaitPanel();       $.ajax({		 	     url: "act.shtml?action=doAccount&CHANN_ID="+vCHANN_ID+"&YEAR="+vYEAR+"&MONTH="+vMONTH,		 	     dataType:'json',		 	     async:false,			     type:"POST",			     complete:function(xhr){			     eval("jsonResult = "+xhr.responseText);			     if(jsonResult.success===true){			        parent.showMsgPanel(utf8Decode(jsonResult.messages));				    window.location="act.shtml?action=toList" + window.reqParamsEx();			     }else			     {			        parent.showErrorMsg(utf8Decode(jsonResult.messages));			        window.location="act.shtml?action=toList" + window.reqParamsEx();			      }			   }	    });}function cancleAccount(vCHANN_ID,vYEAR,vMONTH,vSTATE){		if(vSTATE!='已月结')	{	  parent.showErrorMsg("当前年份、月份没有月结，不能取消!");	  return false;	}	//判断是否符合月结条件	$.ajax({	 	url: "act.shtml?action=cancleAccount&CHANN_ID="+vCHANN_ID+"&YEAR="+vYEAR+"&MONTH="+vMONTH+"&STATE="+vSTATE,	 	dataType:'json',	 	async:false,		type:"POST",		complete:function(xhr){		    eval("jsonResult = "+xhr.responseText);			if(jsonResult.success===true){			    parent.showMsgPanel(utf8Decode(jsonResult.messages));				window.location="act.shtml?action=toList" + window.reqParamsEx();			}else			{			    parent.showErrorMsg(utf8Decode(jsonResult.messages));			    window.location="act.shtml?action=toList" + window.reqParamsEx();			}		}	});}//0117858 徐玲 2013-08-27 beginfunction setSelEids(obj,ztid){    $(obj).attr("checked",'true');	//设置选中的Id	parent.document.getElementById("selRowId").value = $(obj).val();	//重复设置是为了修改时方便调用公用方法 reqParamsEx()	$("#selRowId").attr("value",$(obj).val());}//0117858 徐玲 2013-08-27 end//006 ZHENGYI 20131114 BEGIN//检查该财政周期下是否有未处理单据function checkWCL(vFINANCIAL_CYCLE,vCYCLE_START,vCYCLE_END,vCYCLE_NAME){		var vNFYF=$("#NFYF").val();	 	$.ajax({			url: "act.shtml?action=checkWCL&FINANCIAL_CYCLE="+vFINANCIAL_CYCLE+"&CYCLE_START="+vCYCLE_START+"&CYCLE_END="+vCYCLE_END+"&CYCLE_NAME="+vCYCLE_NAME+"&NFYF="+vNFYF,			type:"POST",			dataType:"text",			async:false,			complete: function(xhr){				eval("jsonResult = "+xhr.responseText);				if(jsonResult.success===true){					doAccount(vFINANCIAL_CYCLE,vCYCLE_START,vCYCLE_END,vCYCLE_NAME);				}else{					var result = window.showModalDialog("act.shtml?action=toWCLList&FINANCIAL_CYCLE="+vFINANCIAL_CYCLE,'','dialogTop:0;dialogWidth:'+(window.screen.availWidth)+'px;DialogHeight='+(window.screen.availHeight)+'px;help=0;center=1;status:no;scroll=1');					setCommonPageInfo(false);					if(result == 1){					 	parent.showMsgPanel("月结成功");						window.location="act.shtml?action=toList" + window.reqParamsEx();					}				}			}		});	 }	function showWcl(){		var vFINANCIAL_CYCLE=$("#FINANCIAL_CYCLE").val();		var vCYCLE_START=$("#CYCLE_START").val();		var vCYCLE_END=$("#CYCLE_END").val();		var vCYCLE_NAME=$("#CYCLE_NAME").val();		var vNFYF=$("#NFYF").val();		if(vFINANCIAL_CYCLE==""||vFINANCIAL_CYCLE==null||vCYCLE_NAME==""||vCYCLE_NAME==null){		  parent.showErrorMsg("请选择财政周期!");		  return false;		}		if(vCYCLE_START==""||vCYCLE_START==null){		  parent.showErrorMsg("该财政周期没有开始日期!");		  return false;		}		if(vCYCLE_END==""||vCYCLE_END==null){		  parent.showErrorMsg("该财政周期没有结束日期!");		  return false;		}		if(vCYCLE_NAME==""||vCYCLE_NAME==null){		  parent.showErrorMsg("该财政周期没有名称!");		  return false;		}	 	$.ajax({			url: "act.shtml?action=checkWCL&FINANCIAL_CYCLE="+vFINANCIAL_CYCLE+"&CYCLE_START="+vCYCLE_START+"&CYCLE_END="+vCYCLE_END+"&CYCLE_NAME="+vCYCLE_NAME+"&NFYF="+vNFYF,			type:"POST",			dataType:"text",			async:false,			complete: function(xhr){				eval("jsonResult = "+xhr.responseText);				if(jsonResult.success===true){					parent.showMsgPanel("该财政周期内没有未处理单据");				}else{					var result = window.showModalDialog("act.shtml?action=toWCLList&FINANCIAL_CYCLE="+vFINANCIAL_CYCLE+"&showFlag=1",'','dialogTop:0;dialogWidth:'+(window.screen.availWidth)+'px;DialogHeight='+(window.screen.availHeight)+'px;help=0;center=1;status:no;scroll=1');					setCommonPageInfo(false);				}			}		});	 }//006 ZHENGYI 20131114 END